<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comic Book Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #141414;
            color: #fff;
        }
        .netflix-red {
            background-color: #e50914;
        }
        .netflix-red-text {
            color: #e50914;
        }
    </style>
</head>
<body class="antialiased">
    <header class="bg-black py-4">
        <div class="container mx-auto text-center">
            <h1 class="text-3xl font-bold netflix-red-text">Comic Book Analyzer</h1>
        </div>
    </header>

    <main class="container mx-auto mt-10 p-4">
        <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
            <h2 class="text-2xl font-semibold mb-4">Upload Your Comic Data</h2>
            <p class="mb-4">Upload a `.txt` file with headings and entries. Each entry should be on a new line, formatted as `Name ChapterCount`.</p>
            <input type="file" id="file-upload" accept=".txt" class="block w-full text-sm text-gray-400
                file:mr-4 file:py-2 file:px-4
                file:rounded-full file:border-0
                file:text-sm file:font-semibold
                file:bg-red-50 file:text-red-700
                hover:file:bg-red-100
            "/>
            <p id="error-message" class="text-red-500 mt-2"></p>
        </div>

        <!-- Container for the dynamically generated tables -->
        <div id="tables-container" class="mt-8"></div>
    </main>

    <script>
        const fileUpload = document.getElementById('file-upload');
        const errorMessage = document.getElementById('error-message');
        const tablesContainer = document.getElementById('tables-container');

        fileUpload.addEventListener('change', (event) => {
            const file = event.target.files[0];

            if (!file) {
                return;
            }

            if (file.type !== 'text/plain') {
                errorMessage.textContent = 'Error: Please upload a .txt file.';
                tablesContainer.innerHTML = ''; // Clear previous tables
                return;
            }

            errorMessage.textContent = '';

            const reader = new FileReader();
            reader.onload = (e) => {
                const content = e.target.result;
                processData(content);
            };
            reader.readAsText(file);
        });

        function processData(data) {
            const lines = data.split(/\r?\n/).filter(line => line.trim() !== '');

            if (lines.length === 0) {
                errorMessage.textContent = 'File is empty or contains no valid data.';
                tablesContainer.innerHTML = '';
                return;
            }

            const categories = {};
            let currentCategory = null;

            lines.forEach(line => {
                const trimmedLine = line.trim();
                // Regex to find a name (can include spaces) and a number at the end of the line.
                const entryMatch = trimmedLine.match(/^(.*[a-zA-Z].*)\s+(\d+)$/);

                if (entryMatch) {
                    // This is a valid entry with a name and chapter count.
                    if (!currentCategory) {
                        // Entries found before any category was defined.
                        // We can assign them to a default category.
                        currentCategory = "Uncategorized";
                        categories[currentCategory] = [];
                    }
                    const name = entryMatch[1].trim();
                    const chapters = parseInt(entryMatch[2], 10);
                    categories[currentCategory].push({ name, chapters });
                } else {
                    // This line does not end with a number, so treat it as a new category heading.
                    currentCategory = trimmedLine;
                    if (!categories[currentCategory]) {
                        categories[currentCategory] = [];
                    }
                }
            });
            
            renderTables(categories);
        }

        function renderTables(categories) {
            // Clear any existing tables
            tablesContainer.innerHTML = '';

            for (const categoryName in categories) {
                const entries = categories[categoryName];

                // Create a container for the table
                const tableWrapper = document.createElement('div');
                tableWrapper.className = 'bg-gray-800 p-6 rounded-lg shadow-lg mt-8';

                // Add the category title
                const title = document.createElement('h2');
                title.className = 'text-2xl font-semibold mb-4 netflix-red-text';
                title.textContent = categoryName;
                tableWrapper.appendChild(title);

                if (entries.length > 0) {
                    // Create the table element
                    const table = document.createElement('table');
                    table.className = 'w-full text-left';

                    // Create table header
                    const thead = document.createElement('thead');
                    thead.innerHTML = `
                        <tr class="border-b border-gray-600">
                            <th class="p-2">Name</th>
                            <th class="p-2 text-right">Chapters Read</th>
                        </tr>
                    `;
                    table.appendChild(thead);

                    // Create table body and rows
                    const tbody = document.createElement('tbody');
                    entries.forEach(entry => {
                        const row = document.createElement('tr');
                        row.className = 'border-b border-gray-700';
                        row.innerHTML = `
                            <td class="p-2">${entry.name}</td>
                            <td class="p-2 text-right">${entry.chapters}</td>
                        `;
                        tbody.appendChild(row);
                    });
                    table.appendChild(tbody);
                    tableWrapper.appendChild(table);
                } else {
                    const noEntriesMessage = document.createElement('p');
                    noEntriesMessage.textContent = "No entries with chapter counts in this category.";
                    tableWrapper.appendChild(noEntriesMessage);
                }

                tablesContainer.appendChild(tableWrapper);
            }
        }
    </script>
</body>
</html>
