<!DOCTYPE html>
<html lang="en" style="scroll-behavior: smooth;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comic Book Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- PDF.js library for handling PDF files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <style>
        body {
            background-color: #141414;
            color: #fff;
            padding-left: 3.5rem; /* Add padding to prevent content from overlapping with the fixed button */
        }
        .netflix-red {
            background-color: #e50914;
        }
        .netflix-red-text {
            color: #e50914;
        }
        /* Custom scrollbar for a more modern look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f1f1f;
        }
        ::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #e50914;
        }
        #menu-btn {
            position: fixed;
            top: 50%;
            left: 1rem; /* 16px */
            transform: translateY(-50%);
            z-index: 50;
            background-color: rgba(31, 41, 55, 0.75); /* bg-gray-800 with opacity */
            border-radius: 9999px; /* rounded-full */
            padding: 0.5rem; /* p-2 */
            transition: background-color 0.2s;
        }
    </style>
</head>
<body class="antialiased">
    <button id="menu-btn" class="text-white focus:outline-none">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>

    <div class="pl-20"> <!-- Add padding to the left of the content to avoid overlap with the button -->
        <header class="bg-black py-4 shadow-lg z-20 relative">
            <div class="container mx-auto text-center px-4">
                <h1 class="text-3xl font-bold text-white">Manga List</h1>
            </div>
        </header>

        <!-- Sidebar -->
        <aside id="sidebar" class="fixed top-0 left-0 h-full w-64 bg-gray-900 p-4 shadow-lg transform -translate-x-full transition-transform duration-300 ease-in-out z-40">
            <h3 class="text-lg font-semibold mb-4 border-b border-gray-600 pb-2">Categories</h3>
            <ul id="sidebar-links" class="space-y-2">
                <!-- Links will be dynamically inserted here -->
            </ul>
        </aside>

        <!-- Overlay -->
        <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-30"></div>

        <!-- Main Content -->
        <div class="container mx-auto mt-10 px-4">
            <main>
                <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                    <h2 class="text-2xl font-semibold mb-4">Upload Your Comic Data</h2>
                    <p class="mb-4">Upload a `.txt` or `.pdf` file with headings and entries. Each entry should be on a new line, formatted as `Name ch ChapterCount`.</p>
                    <input type="file" id="file-upload" accept=".txt,.pdf" class="block w-full text-sm text-gray-400
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-full file:border-0
                        file:text-sm file:font-semibold
                        file:bg-red-50 file:text-red-700
                        hover:file:bg-red-100
                    "/>
                    <p id="error-message" class="text-red-500 mt-2"></p>
                </div>

                <!-- Container for the dynamically generated tables -->
                <div id="tables-container" class="mt-8"></div>
            </main>
        </div>
    </div>

    <script>
        // Set the worker source for PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';

        const fileUpload = document.getElementById('file-upload');
        const errorMessage = document.getElementById('error-message');
        const tablesContainer = document.getElementById('tables-container');
        
        const sidebar = document.getElementById('sidebar');
        const menuBtn = document.getElementById('menu-btn');
        const overlay = document.getElementById('overlay');
        const sidebarLinks = document.getElementById('sidebar-links');

        // Define the fixed list of headings
        const PREDEFINED_HEADINGS = ['Manga', 'Manhwa', 'Manhua', 'OG Manhwa', 'OG Manhua', 'NG Manhwa', 'NG Manhua', 'Ero', 'To read', 'Incomplete'];

        // --- Sidebar Logic ---
        function toggleSidebar() {
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        }

        menuBtn.addEventListener('click', (e) => {
            e.stopPropagation(); // Prevent click from immediately closing sidebar if other listeners exist
            toggleSidebar();
        });

        overlay.addEventListener('click', toggleSidebar);

        sidebarLinks.addEventListener('click', (e) => {
            if (e.target.tagName === 'A' && e.target.href) {
                // Smooth scroll to the section
                const targetId = e.target.getAttribute('href').substring(1);
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth' });
                }
                // Close sidebar after navigation
                toggleSidebar();
            }
        });


        // --- File Processing Logic ---
        fileUpload.addEventListener('change', (event) => {
            const file = event.target.files[0];

            if (!file) return;

            const fileType = file.type;
            if (fileType !== 'text/plain' && fileType !== 'application/pdf') {
                errorMessage.textContent = 'Error: Please upload a .txt or .pdf file.';
                tablesContainer.innerHTML = '';
                sidebarLinks.innerHTML = '';
                return;
            }

            errorMessage.textContent = '';
            const reader = new FileReader();

            if (fileType === 'text/plain') {
                reader.onload = (e) => processData(e.target.result);
                reader.readAsText(file);
            } else if (fileType === 'application/pdf') {
                reader.onload = (e) => {
                    const typedarray = new Uint8Array(e.target.result);
                    pdfjsLib.getDocument(typedarray).promise.then(pdf => {
                        const pagePromises = Array.from({ length: pdf.numPages }, (_, i) => 
                            pdf.getPage(i + 1).then(page => 
                                page.getTextContent().then(textContent => 
                                    textContent.items.map(item => item.str).join(' ')
                                )
                            )
                        );
                        Promise.all(pagePromises).then(pageTexts => {
                            processData(pageTexts.join('\n'));
                        });
                    });
                };
                reader.readAsArrayBuffer(file);
            }
        });

        function processData(data) {
            const lines = data.split(/\r?\n/).filter(line => line.trim() !== '');

            if (lines.length === 0) {
                errorMessage.textContent = 'File is empty or contains no valid data.';
                tablesContainer.innerHTML = '';
                sidebarLinks.innerHTML = '';
                return;
            }

            const categories = PREDEFINED_HEADINGS.reduce((acc, h) => ({...acc, [h]: [] }), {});
            let currentCategory = null;

            lines.forEach(line => {
                const trimmedLine = line.trim();
                const isHeading = PREDEFINED_HEADINGS.find(h => h.toLowerCase() === trimmedLine.toLowerCase());

                if (isHeading) {
                    currentCategory = isHeading;
                } else {
                    const entryMatch = trimmedLine.match(/^\[(.*?)\s+(Ch\s+\d+)\]$/i);
                    if (entryMatch && currentCategory) {
                        const name = entryMatch[1].trim();
                        const chapters = entryMatch[2];
                        if (name) {
                            categories[currentCategory].push({ name, chapters });
                        }
                    }
                }
            });
            
            renderTablesAndSidebar(categories);
        }

        function renderTablesAndSidebar(categories) {
            tablesContainer.innerHTML = '';
            sidebarLinks.innerHTML = '';

            PREDEFINED_HEADINGS.forEach(categoryName => {
                const entries = categories[categoryName];

                if (entries && entries.length > 0) {
                    const categoryId = `category-${categoryName.replace(/\s+/g, '-')}`;

                    // Add link to sidebar
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `<a href="#${categoryId}" class="block text-gray-300 hover:text-white hover:bg-gray-700 p-2 rounded-md transition-colors duration-200">${categoryName}</a>`;
                    sidebarLinks.appendChild(listItem);

                    // Create and render the table
                    const tableWrapper = document.createElement('div');
                    tableWrapper.id = categoryId;
                    tableWrapper.className = 'bg-gray-800 p-6 rounded-lg shadow-lg mt-8 scroll-mt-20'; // scroll-mt-20 to offset for header

                    const title = document.createElement('h2');
                    title.className = 'text-2xl font-semibold mb-4 netflix-red-text';
                    title.textContent = categoryName;
                    tableWrapper.appendChild(title);

                    const table = document.createElement('table');
                    table.className = 'w-full text-left';

                    const thead = document.createElement('thead');
                    thead.innerHTML = `
                        <tr class="border-b border-gray-600">
                            <th class="p-2 w-16">S.No</th>
                            <th class="p-2">Name</th>
                            <th class="p-2 text-right">Chapters Read</th>
                        </tr>
                    `;
                    table.appendChild(thead);

                    const tbody = document.createElement('tbody');
                    entries.forEach((entry, index) => {
                        const row = document.createElement('tr');
                        row.className = 'border-b border-gray-700';
                        row.innerHTML = `
                            <td class="p-2">${index + 1}</td>
                            <td class="p-2">${entry.name}</td>
                            <td class="p-2 text-right">${entry.chapters}</td>
                        `;
                        tbody.appendChild(row);
                    });
                    table.appendChild(tbody);
                    tableWrapper.appendChild(table);
                    
                    tablesContainer.appendChild(tableWrapper);
                }
            });
        }
    </script>
</body>
</html>
